<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<!--Description-->



    <meta name="description" content="MIT &#39;23, Computer Sceince"/>


<!--Author-->

    <meta name="author" content="Utaha"/>


<!--Open Graph Title-->

    <meta property="og:title" content="IJCTF 2021"/>


<!--Open Graph Description-->

    <meta property="og:description" content="MIT &#39;23, Computer Sceince"/>


<!--Open Graph Site Name-->
    <meta property="og:site_name" content="Utaha&#39;s CTF Note"/>

<!--Type page-->

    <meta property="og:type" content="article"/>


<!--Page Cover-->


    <meta property="og:image" content="https://utaha1228.github.io/ctf-note/img/home-bg.jpg"/>


<meta name="twitter:card" content="summary_large_image"/>




    <meta name="twitter:image" content="https://utaha1228.github.io/ctf-note/img/home-bg.jpg"/>


<!-- Title -->

<title>IJCTF 2021 | Utaha&#39;s CTF Note</title>

<!-- Bootstrap Core CSS -->
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css">

<!-- Custom CSS -->

<link rel="stylesheet" href="/ctf-note/css/main.css">


<!-- Custom Fonts -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.0/css/all.min.css" />
<link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.0/css/all.min.css" />
<link href="//fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
<link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"/>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Gallery -->
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/featherlight@1.4.0/src/featherlight.css" integrity="sha256-30DV/STftlyQ6v8yaOWlabammvCYtRJERLj/m0b3zno=" crossorigin="anonymous">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/lightgallery@1.6.11/dist/css/lightgallery.min.css">

<!-- favicon -->

<link rel="icon" href="/ctf-note/img/favicon.png"/>



    <!-- Google Analytics -->
    


<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head>
<!-- Head tag -->

<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top bg-transparent position-absolute w-100 p-0" id="nav">
    <div class="container pl-0 pr-0">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <a class="navbar-brand text-white p-1 pl-3" href="/ctf-note/">Utaha's CTF Note</a>
        </div>
        <div>
            <!--  -->
            
                <li class="list-inline-item">
                    <!-- 
                     -->
                    <a class = "navbar-list text-white p-1 pl-3" style = "text-decoration: none;" href="/ctf-note/">
                        
                            Home
                        
                    </a>
                </li>
            
                <li class="list-inline-item">
                    <!-- 
                        <span class="copyright-split">&nbsp;|&nbsp;</span>
                    
                     -->
                    <a class = "navbar-list text-white p-1 pl-3" style = "text-decoration: none;" href="/ctf-note/archives">
                        
                            Archives
                        
                    </a>
                </li>
            
                <li class="list-inline-item">
                    <!-- 
                        <span class="copyright-split">&nbsp;|&nbsp;</span>
                    
                     -->
                    <a class = "navbar-list text-white p-1 pl-3" style = "text-decoration: none;" href="/ctf-note/tags/writeup">
                        
                            Tags
                        
                    </a>
                </li>
            
                <li class="list-inline-item">
                    <!-- 
                        <span class="copyright-split">&nbsp;|&nbsp;</span>
                    
                     -->
                    <a class = "navbar-list text-white p-1 pl-3" style = "text-decoration: none;" href="/ctf-note/about">
                        
                            About
                        
                    </a>
                </li>
            
        </div>
        <div class="navbar-nav float-right">
            <button class="btn btn-link search-btn navbar-item" data-toggle="modal" data-target="#searchModal">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('/ctf-note/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12 text-center">
                <div class="post-heading text-white">
                    <h1>IJCTF 2021</h1>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Main Content -->
            <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1">
                
                    <span class="meta d-inline-block">
    
    
    <!-- Date -->
    
        <span class="post-meta-split">&nbsp;|&nbsp;</span>
        <i class="far fa-calendar-check fa-fw"></i>
        2021-07-24
    
    <!-- word count and read count -->
    

    

    
        <span class="post-meta-split">&nbsp;|&nbsp;</span>
        <i class="far fa-eye fa-fw"></i>
        <span id="busuanzi_value_page_pv"></span>
    
</span>  
                
                <h2 id="intro">Intro</h2>
<p>There were 5 crypto problems in this contest, and I solved 4 of them: Discrete Log, Square Sum, ECSign, and Quartic</p>
<p>The event link is <a target="_blank" rel="noopener" href="https://ctftime.org/event/1382">here</a></p>
<h2 id="discrete-log">Discrete Log</h2>
<h3 id="description">Description</h3>
<p>We are given <span class="math inline">\(N\)</span>, <span class="math inline">\(e\)</span>, and ciphertext in the context of RSA. We are also given an oracle which solves the dicrete log problem modulo <span class="math inline">\(N\)</span>, in other word, outputs a <span class="math inline">\(x\)</span> satisfy</p>
<p><span class="math display">\[ a^x \equiv b \pmod{N}\]</span></p>
<p>given input <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>. There were no source code and we have no idea how it computes discrete log.</p>
<h3 id="solution">Solution</h3>
<p>The first thing that came into my mind is that <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> must be special so that the discrete log problem can be solved easily. However, it is just too guessy and I quickly give up on this. Then I realized that if we give them <span class="math inline">\((a, 1)\)</span> as input, they will give us an <span class="math inline">\(x\)</span> such that</p>
<p><span class="math display">\[a^x \equiv 1 \pmod{N}\]</span></p>
<p>Therefore, <span class="math inline">\(x \mid \phi(N)\)</span>. Since <span class="math inline">\(\phi(N)\)</span> is really close to <span class="math inline">\(N\)</span>, we can recover it from <span class="math inline">\(x\)</span> easily. It turned out the server just give us <span class="math inline">\(x = 0\)</span>, which is trivial. However, with a simple modification, we can solve the problem! We send <span class="math inline">\((a, n - 1)\)</span> as input, and they respond with a <span class="math inline">\(x\)</span> such that</p>
<p><span class="math display">\[a^x \equiv -1 \pmod {N}\]</span></p>
<p>We have <span class="math inline">\(a^{2x} \equiv 1 \pmod {N}\)</span> and <span class="math inline">\(x\)</span> cannot be <span class="math inline">\(0\)</span>! As such discrete log may not always exist, we try several values of <span class="math inline">\(a\)</span> and wait for a valid <span class="math inline">\(x\)</span>. With <span class="math inline">\(x\)</span>, we find a multiple that is smaller but really close to <span class="math inline">\(N\)</span> and that will be the <span class="math inline">\(\phi(N)\)</span>. The rest is trivial.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line">getcontext().prec = <span class="number">500</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;35.244.0.8&#x27;</span>, <span class="number">34712</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&quot;Mod: &quot;</span>)</span><br><span class="line">N = <span class="built_in">int</span>(r.recvline().strip())</span><br><span class="line">r.recvuntil(<span class="string">b&quot;(e=65537)\n&quot;</span>)</span><br><span class="line">flag = <span class="built_in">int</span>(r.recvline().strip())</span><br><span class="line">r.recvuntil(<span class="string">b&quot;base:&quot;</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">41</span>, <span class="number">43</span>, <span class="number">47</span>, <span class="number">53</span>]:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(i).encode())</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(N - <span class="number">1</span>).encode())</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;number: &quot;</span>)</span><br><span class="line">    res = r.recvline()</span><br><span class="line">    <span class="keyword">if</span> res.startswith(<span class="string">b&#x27;discrete log is not found&#x27;</span>):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    tmp = <span class="built_in">len</span>(<span class="string">&#x27;Here is the discrete log: &#x27;</span>)</span><br><span class="line">    res = <span class="built_in">int</span>(res[tmp:].decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line">    phi = N // res * res</span><br><span class="line">    PLUS = N + <span class="number">1</span> - phi</span><br><span class="line">    _ = Decimal(PLUS * PLUS - N * <span class="number">4</span>) ** (<span class="number">1</span> / Decimal(<span class="number">2</span>))</span><br><span class="line">    _ = <span class="built_in">int</span>(_)</span><br><span class="line">    p = (PLUS + _) // <span class="number">2</span></span><br><span class="line">    q = PLUS - p</span><br><span class="line">    <span class="keyword">assert</span> p * q == N</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">    m = <span class="built_in">pow</span>(flag, d, N)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line">    exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h2 id="square-sum">Square Sum</h2>
<h3 id="description-1">Description</h3>
<p>We are given <span class="math inline">\(n\)</span>, <span class="math inline">\(S = \left(\frac{p - 1}{2}\right)^2 + \left(\frac{q - 1}{2}\right)^2\)</span> such that <span class="math inline">\(n = pq\)</span>, then we have a bunch of calculations <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">n2 = n * n</span><br><span class="line">k = randint(<span class="number">1</span>, n-<span class="number">1</span>)</span><br><span class="line">g = <span class="number">1</span> + k*n</span><br><span class="line">r = randint(<span class="number">2</span>, n2-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">cmsg = (<span class="built_in">pow</span>(g, bytes_to_long(MSG), n2) * <span class="built_in">pow</span>(r, n2, n2)) % n2</span><br><span class="line">c = (bytes_to_long(FLAG) * <span class="built_in">pow</span>(r, n, n2)) % n2</span><br></pre></td></tr></table></figure> and we only know <code>cmsg</code> and <code>c</code>.</p>
<h3 id="solution-1">Solution</h3>
<p>The first step is to factorize <span class="math inline">\(n\)</span>. It is quite straight forward with a little math.</p>
<p><span class="math display">\[4S - 1 + 2n = p^2 + q^2 + 2pq - 2(p + q) + 1 = (p + q - 1)^2\]</span> <span class="math display">\[p = \frac{1}{2}\left((p + q) + \sqrt{(p + q)^2 - 4pq}\right)\]</span></p>
<p>The second step is to break down those weird calculations. We can get <code>r % n</code> by taking the first equation modulo <span class="math inline">\(n\)</span> instead of <span class="math inline">\(n^2\)</span> as we can drop the term with <span class="math inline">\(g\)</span>:</p>
<p><span class="math display">\[r^{n^2} \equiv \text{cmsg} \pmod{n}\]</span></p>
<p>Since the factorization of <span class="math inline">\(n\)</span> is known, we can calculate <code>r = pow(cmsg, pow(n^2, -1, phi))</code> where <code>phi = (p - 1) * (q - 1)</code>. Move on to the next line, notice that</p>
<p><span class="math display">\[(r + n)^n \equiv r^n + \binom{n}{1} r^{n-1}n + \binom{n}{2} r^{n-2}n^2 + \cdots + n^n \equiv r^n \pmod{n^2}\]</span></p>
<p><span class="math inline">\(x^n\)</span> is periodic modulo <span class="math inline">\(n^2\)</span> with period <span class="math inline">\(n\)</span>. Therefore, we can directly calculate <code>FLAG = c * pow(r, -n, n2) % n2</code> without knowing <code>r % n2</code>. The message is not recover-able because of the randomness of <span class="math inline">\(k\)</span>, but the flag is retrieved.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line">getcontext().prec = <span class="number">1500</span></span><br><span class="line">n2=<span class="number">303520029249457721712088032629157671188675957478999814001107946377897435098262416944078032743694224547812111876508629629098790706348564683510627437608561667668817082232066690156773182947457415470637661555594387660242481075809061863866878134857767064271020275925358862373499666674028571177472256983693456175513694920187605044808723618380459789773493111510245511524263712883363099195516392023821523383273803607532258960986269523229557484356691226627296549458770890488302153036171491536959410916079515480053813267273641384674290430132960320985260531094724351210760834427441063392448845773608652498658579592730319172250637383076619273369963514086477217760274026803102575002211426718751927101891471494221058041179582203541771830433523526001577817599554252231872769532980390483401226639528096938277398399935682866324784993115812281877591865430215134442904551109441541036428784450911307551504003791948952027070850252232846043561327951083360866399333467139115782229855840846646026182204713128402629095939971393271042355316329494426040959059666926611479882720948473312355005677824274551575679913205670022022017139399175510998237850213737165974646339820009635040028632254754412047567426260382111848392850835481772030875035608845098368736718689</span></span><br><span class="line">halfpq_sqr_sum=<span class="number">9472622129700199703245586196664170084403806786939405819609832782578112766576428480777927359491256761393588992261088804683630755557509473029147106633909601585974763553680654431838374713192695971152635135654980642968043058123569343691081887394840682085558030205578048546258148505272998984973693174088527063719679039240127298660482089717632821831294015315634267021396765367208053481029040950107066330391869209058343986685994748025768502912822369180563838868099092781901052919510720948179559741776416837917783632982451736331078296715767630096860173482291944176969440690386874499002706015031896162301715990323012706805065</span></span><br><span class="line">cmsg=<span class="number">103078286643622880447473687471766764943564559811909431666893450054168818307349486985249638958378791065494084728451034371725501517686576282043339068765538253257675113627273797306564684365323509359273378294002601649860804748728163025522075672245295550880060720735463310260935029330499002606032562798724954111417118887527073957993508089754394967659543003785760047941879904675059060008485376318332423664374757995851806458605666638976841133899950278214115072866022244614110580100352950200691110948074551191407363470332793295773273747237585817004577206834980715049990997687288385068292724282066219625651831484886243730221023243574538535723396702634705817852703892641398427064494429830352214499320005058534474284577134432341253340519635081380378045892077000915627548861547061501696012768786270148594424943366660662587186418716670250433370555760184571143569773295737850383542649898270826382659942188410185848934468448568325496582525158048118061659983332451282069426273006110854670823360391164278996722155588697598627131803289512431866077055012911415395954770914537654639608929010542439756174537575923529600976400363945111089267192377586187238410504823191760221711696006651813981609780080767483863025507048248680195946925116086994713836313403</span></span><br><span class="line">c=<span class="number">240819054139924192908276790404232331564539338066363967597355786532131090443403077278934264677782549578055871874639814497554138070603843470651529113660894021443057595391213699869840820555076709709812961373461750130612453785640822249347659164866017931889613080220570111764428471836538389725220257679376309813972857596742069449014122286177227320041653912468408726067139524231446702068292851152761999746103029142674572600075554585602575858028536948546991047817318676231622316199368535515883188272917775993105890398456057174036933873324756054332572569380343179450564438637126650504362820450286638292251182022086719737414761084603628504362175295748323721068857285078233340896776610403227874250072420794722246884387488198976386566266870301419765724246635936193987658699901284391726429640605754046472825878500017779396277376213443347956951870554421838859114868247676278966446582371758603658584495387466611294920606637857755221756257214625128936810241588259047215874829610442603034882068648615080256023583472836142327431962452607719206361748849195548395481842814703649891102211953579454296662259004591314057576449118621217086325140123543677458167848297604521746504718023238069208215956158087066756140657191702426263476717009016863723080567809</span></span><br><span class="line"></span><br><span class="line">n = <span class="built_in">int</span>(Decimal(n2).sqrt())</span><br><span class="line"><span class="keyword">assert</span> n * n == n2</span><br><span class="line"></span><br><span class="line">_ = <span class="number">4</span> * halfpq_sqr_sum - <span class="number">2</span> + <span class="number">2</span> * n + <span class="number">1</span></span><br><span class="line">PLUS = <span class="built_in">int</span>(Decimal(_).sqrt()) + <span class="number">1</span></span><br><span class="line"><span class="keyword">assert</span> PLUS % <span class="number">2</span> == <span class="number">0</span></span><br><span class="line">MINUS = <span class="built_in">int</span>(Decimal(PLUS * PLUS - <span class="number">4</span> * n).sqrt())</span><br><span class="line"><span class="keyword">assert</span> MINUS % <span class="number">2</span> == <span class="number">0</span></span><br><span class="line">p = (PLUS + MINUS) // <span class="number">2</span></span><br><span class="line">q = PLUS - p</span><br><span class="line"><span class="keyword">assert</span> p * q == n</span><br><span class="line"></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">rnn = cmsg % n</span><br><span class="line">r = <span class="built_in">pow</span>(rnn, <span class="built_in">pow</span>(n2, -<span class="number">1</span>, phi), n)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">pow</span>(r, n2, n) == cmsg % n</span><br><span class="line">flag = c * <span class="built_in">pow</span>(r, -n, n2) % n2</span><br><span class="line"><span class="keyword">assert</span> (flag * <span class="built_in">pow</span>(r, n, n2)) % n2 == c % n2</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(flag)[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure>
<h2 id="ecsign">ECSign</h2>
<h3 id="description-2">Description</h3>
<p>The main part of this problem is to recover the private key with the EC sign. We are given 3 signatures of the same message, with the same <code>r</code> (which is really sus) and nonce <code>k</code>, <code>k^0xffffffff</code>, <code>k^0xffffffff00000000</code>. The algorithm of signing is</p>
<p><span class="math display">\[\text{sig} \equiv \frac{h + d_Ar}{k} \pmod{n}\]</span></p>
<p>where <span class="math inline">\(d_A\)</span> is the private key, and <span class="math inline">\(h\)</span> is the hash of the message.</p>
<h3 id="solution-2">Solution</h3>
<p>Notice that the numerator of the signature is fixed in all 3 signatures. Let <span class="math inline">\(\alpha = h + d_Ar\)</span>, we have</p>
<p><span class="math display">\[k_i \equiv \frac{\alpha}{sig_i}\]</span></p>
<p>Since <span class="math inline">\(k_i\)</span>s do not differ too much, both <span class="math inline">\(\alpha(sig_1^{-1} - sig_2^{-1})\)</span> and <span class="math inline">\(\alpha(sig_1^{-1} - sig_3^{-1})\)</span> have a small absolute value modulo <span class="math inline">\(n\)</span>. Let <span class="math inline">\(x = sig_1^{-1} - sig_2^{-1}\)</span> and <span class="math inline">\(y = sig_1^{-1} - sig_3^{-1}\)</span>, then there exist small <span class="math inline">\((a, b)\)</span> such that <span class="math inline">\(n \mid ax + by\)</span>. Therefore, we can construct a lattice:</p>
<p><span class="math display">\[\begin{pmatrix}
1 &amp; 0 &amp; x\\
0 &amp; 1 &amp; y\\
0 &amp; 0 &amp; n
\end{pmatrix}\]</span></p>
<p>and solve <span class="math inline">\((a, b)\)</span> and <span class="math inline">\(\alpha\)</span> by LLL algorithm. We can recover the private key from <span class="math inline">\(\alpha\)</span> easily.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">from</span> ecdsa <span class="keyword">import</span> NIST256p</span><br><span class="line"><span class="keyword">from</span> ecdsa.ellipticcurve <span class="keyword">import</span> Point</span><br><span class="line"></span><br><span class="line">message = <span class="string">b&quot;ECDSA prevents forging messages&quot;</span></span><br><span class="line"></span><br><span class="line">curve = NIST256p</span><br><span class="line">G = curve.generator</span><br><span class="line">n = <span class="built_in">int</span>(curve.order)</span><br><span class="line"></span><br><span class="line">hsh = <span class="built_in">int</span>(hashlib.sha256(message).hexdigest(), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">pubkey = Point(curve.curve, <span class="number">38745398585592404989617041657020362138123363380468846963780930586996547144750</span>, <span class="number">13643061224989896432264609612335708262502935494164515568037402963951605264829</span>)</span><br><span class="line">r = <span class="number">77834524933954296097833315313842984664992628710802286706422333910202549804044</span></span><br><span class="line">sig1 = <span class="built_in">pow</span>(<span class="number">106047115067349115009621212644299274382951056066902044358604548248126784117113</span>, -<span class="number">1</span>, n)</span><br><span class="line">sig2 = <span class="built_in">pow</span>(<span class="number">77856639655128453708803009032309618307780628811843761077611198123911335033581</span>, -<span class="number">1</span>, n)</span><br><span class="line">sig3 = <span class="built_in">pow</span>(<span class="number">113246340396800206689440828533000149451101779708634101475318788958650261939751</span>, -<span class="number">1</span>, n)</span><br><span class="line"></span><br><span class="line">x = (sig2 - sig1) % n</span><br><span class="line">y = (sig3 - sig1) * <span class="built_in">pow</span>(<span class="number">0x100000000</span>, -<span class="number">1</span>, n) % n</span><br><span class="line"></span><br><span class="line"><span class="comment"># x * (hsh + da * r) % n &lt; 0xffffffff</span></span><br><span class="line"><span class="comment"># y * (hsh + da * r) % n &lt; 0xffffffff</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> olll <span class="keyword">import</span> reduction</span><br><span class="line">reduced_basis = reduction([[<span class="number">1</span>, <span class="number">0</span>, x], [<span class="number">0</span>, <span class="number">1</span>, y], [<span class="number">0</span>, <span class="number">0</span>, n]], <span class="number">0.75</span>)</span><br><span class="line">a, b, c = reduced_basis[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">assert</span> c == <span class="number">0</span></span><br><span class="line"><span class="comment"># _ = hsh + da * r</span></span><br><span class="line">_ = b * <span class="built_in">pow</span>(x, -<span class="number">1</span>, n)</span><br><span class="line">privkey = (_ - hsh) * <span class="built_in">pow</span>(r, -<span class="number">1</span>, n) % n</span><br><span class="line"></span><br><span class="line">pubkey2 = Point(curve.curve, <span class="number">18408891362196717436082197656011814689561019672942300120844335017129989755383</span>, <span class="number">89780168462818288492260141231746707551390283872983535472764708240708422195758</span>)</span><br><span class="line">sharedkey = pubkey2 * privkey</span><br><span class="line">key = long_to_bytes(<span class="built_in">int</span>(sharedkey.x()))</span><br><span class="line">iv=<span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;1d828a4a93bc2026ae1c8ab1711a1991&#x27;</span>)</span><br><span class="line">ct=<span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;8c5350234cf12b0f4da1d344124fe76e29906fbf5a1ed45cc8c7a29009dc078a31a6150b8ec5be75e1f7cef7665f634b&#x27;</span>)</span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">ct = cipher.decrypt(ct)</span><br><span class="line"><span class="built_in">print</span>(ct)</span><br></pre></td></tr></table></figure>
<h2 id="quartic">Quartic</h2>
<h3 id="description-3">Description</h3>
<p><span class="math inline">\(N\)</span> is the product of 1024-bit primes <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span>, and <span class="math inline">\(p&#39;\)</span> is a an approximation of <span class="math inline">\(p\)</span> such that <span class="math inline">\(|p&#39; - p| &lt; 2^{80}\)</span>. We are given <span class="math inline">\(N\)</span> and a quartic polynomial <span class="math inline">\(f\)</span> such that <span class="math inline">\(N \mid f(p&#39;)\)</span>. The goal is to decrypt the ciphertext encrypted by RSA with <span class="math inline">\(N\)</span>.</p>
<h3 id="solution-3">Solution</h3>
<p>This problem is the basic form of Coppersmith Attack. I used the <a target="_blank" rel="noopener" href="https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/coppersmith.sage">script by mimoo</a> to solve the challenge.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">debug = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display matrix picture with 0 and X</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">matrix_overview</span>(<span class="params">BB, bound</span>):</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">coppersmith_howgrave_univariate</span>(<span class="params">pol, modulus, beta, mm, tt, XX</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Coppersmith revisited by Howgrave-Graham</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    finds a solution if:</span></span><br><span class="line"><span class="string">    * b|modulus, b &gt;= modulus^beta , 0 &lt; beta &lt;= 1</span></span><br><span class="line"><span class="string">    * |x| &lt; XX</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># init</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    dd = pol.degree()</span><br><span class="line">    nn = dd * mm + tt</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># checks</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">0</span> &lt; beta &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;beta should belongs in (0, 1]&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> pol.is_monic():</span><br><span class="line">        <span class="keyword">raise</span> ArithmeticError(<span class="string">&quot;Polynomial must be monic.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># calculate bounds and display them</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    * we want to find g(x) such that ||g(xX)|| &lt;= b^m / sqrt(n)</span></span><br><span class="line"><span class="string">    * we know LLL will give us a short vector v such that:</span></span><br><span class="line"><span class="string">    ||v|| &lt;= 2^((n - 1)/4) * det(L)^(1/n)</span></span><br><span class="line"><span class="string">    * we will use that vector as a coefficient vector for our g(x)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    * so we want to satisfy:</span></span><br><span class="line"><span class="string">    2^((n - 1)/4) * det(L)^(1/n) &lt; N^(beta*m) / sqrt(n)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    so we can obtain ||v|| &lt; N^(beta*m) / sqrt(n) &lt;= b^m / sqrt(n)</span></span><br><span class="line"><span class="string">    (it&#x27;s important to use N because we might not know b)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="comment"># t optimized?</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n# Optimized t?\n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;we want X^(n-1) &lt; N^(beta*m) so that each vector is helpful&quot;</span>)</span><br><span class="line">        cond1 = RR(XX^(nn-<span class="number">1</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* X^(n-1) = &quot;</span>, cond1)</span><br><span class="line">        cond2 = <span class="built_in">pow</span>(modulus, beta*mm)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* N^(beta*m) = &quot;</span>, cond2)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* X^(n-1) &lt; N^(beta*m) \n-&gt; GOOD&quot;</span> <span class="keyword">if</span> cond1 &lt; cond2 <span class="keyword">else</span> <span class="string">&quot;* X^(n-1) &gt;= N^(beta*m) \n-&gt; NOT GOOD&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># bound for X</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n# X bound respected?\n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;we want X &lt;= N^(((2*beta*m)/(n-1)) - ((delta*m*(m+1))/(n*(n-1)))) / 2 = M&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* X =&quot;</span>, XX)</span><br><span class="line">        cond2 = RR(modulus^(((<span class="number">2</span>*beta*mm)/(nn-<span class="number">1</span>)) - ((dd*mm*(mm+<span class="number">1</span>))/(nn*(nn-<span class="number">1</span>)))) / <span class="number">2</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* M =&quot;</span>, cond2)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* X &lt;= M \n-&gt; GOOD&quot;</span> <span class="keyword">if</span> XX &lt;= cond2 <span class="keyword">else</span> <span class="string">&quot;* X &gt; M \n-&gt; NOT GOOD&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># solution possible?</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n# Solutions possible?\n&quot;</span>)</span><br><span class="line">        detL = RR(modulus^(dd * mm * (mm + <span class="number">1</span>) / <span class="number">2</span>) * XX^(nn * (nn - <span class="number">1</span>) / <span class="number">2</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;we can find a solution if 2^((n - 1)/4) * det(L)^(1/n) &lt; N^(beta*m) / sqrt(n)&quot;</span>)</span><br><span class="line">        cond1 = RR(<span class="number">2</span>^((nn - <span class="number">1</span>)/<span class="number">4</span>) * detL^(<span class="number">1</span>/nn))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* 2^((n - 1)/4) * det(L)^(1/n) = &quot;</span>, cond1)</span><br><span class="line">        cond2 = RR(modulus^(beta*mm) / sqrt(nn))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* N^(beta*m) / sqrt(n) = &quot;</span>, cond2)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* 2^((n - 1)/4) * det(L)^(1/n) &lt; N^(beta*m) / sqrt(n) \n-&gt; SOLUTION WILL BE FOUND&quot;</span> <span class="keyword">if</span> cond1 &lt; cond2 <span class="keyword">else</span> <span class="string">&quot;* 2^((n - 1)/4) * det(L)^(1/n) &gt;= N^(beta*m) / sqroot(n) \n-&gt; NO SOLUTIONS MIGHT BE FOUND (but we never know)&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># warning about X</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n# Note that no solutions will be found _for sure_ if you don&#x27;t respect:\n* |root| &lt; X \n* b &gt;= modulus^beta\n&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Coppersmith revisited algo for univariate</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># change ring of pol and x</span></span><br><span class="line">    polZ = pol.change_ring(ZZ)</span><br><span class="line">    x = polZ.parent().gen()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># compute polynomials</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm):</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(dd):</span><br><span class="line">            gg.append((x * XX)**jj * modulus**(mm - ii) * polZ(x * XX)**ii)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(tt):</span><br><span class="line">        gg.append((x * XX)**ii * polZ(x * XX)**mm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># construct lattice B</span></span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii+<span class="number">1</span>):</span><br><span class="line">            BB[ii, jj] = gg[ii][jj]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># display basis matrix</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># transform shortest vector in polynomial    </span></span><br><span class="line">    new_pol = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        new_pol += x**ii * BB[<span class="number">0</span>, ii] / XX**ii</span><br><span class="line"></span><br><span class="line">    <span class="comment"># factor polynomial</span></span><br><span class="line">    potential_roots = new_pol.roots()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;potential roots:&quot;</span>, potential_roots)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># test roots</span></span><br><span class="line">    roots = []</span><br><span class="line">    <span class="keyword">for</span> root <span class="keyword">in</span> potential_roots:</span><br><span class="line">        <span class="keyword">if</span> root[<span class="number">0</span>].is_integer():</span><br><span class="line">            result = polZ(ZZ(root[<span class="number">0</span>]))</span><br><span class="line">            <span class="keyword">if</span> gcd(modulus, result) &gt;= modulus^beta:</span><br><span class="line">                roots.append(ZZ(root[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># </span></span><br><span class="line">    <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">N = <span class="number">14696994372012287266063217731371465578678715866132272122977296158042664711913985707735240860887006104199660244194252732513872446957209707813718992065870009198350392025823708604809843097942852887153574791868863759677596709374574270980384013350507776841394348069047979081285459868079488308763109757234951918205929827395300302835788692873505186477300098666817569700699255710985965984118993464275972585327700080430955818549340143244083420792258768933607896874184152407531531128653324411725754823245939716911634247425735766453356062475072240421779566396468043043082651606158198150758975259067495695864660578493393106762631</span></span><br><span class="line">ZmodN = Zmod(N)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">9750527994091121091786816841463772484970643350548409420602551052460114750376765234779160399774157114083542404212321500558790661890217330206975918220078382877833585674657160688057126517189623419338705483072993529673151815011674742481352311071675409754487654783078829059793691828971457847280715985552753121754286619544143717362922120309444897947012514213521135742738481921772607488909188240043132021160662803034095731089505604348170622399204914184546012322270024791178809723808523030967238028593150206277299911554652571555702651337880252089368970936855513446902610214801472036929625184874736910343726791265452474611050</span></span><br><span class="line">seq = [<span class="number">158752811818711918978608809724046452901335596022391874487974890304998816699298753351923479802743256111682434826558127366354372655672162233383691616336809056589770476184830602519936915124324990526086510115052439516943494324074208205263728559181179209273336271456505648791496885861665659702772878794453617597935</span>, <span class="number">128112039454566836699268817573729682217733580513471579004092384875666907545736760938092529139116761787964524453230653391142195587208637498768853852534066440912659539891579333760989970185793933487448394446383099379350084438155354954554485354584606335545683635861714347785116146996111161679962531883524512245756</span>, <span class="number">125394898446858383529773530925952405484923255072498779305263565535739539843809683956661976383945903145655388058775285644922423567418124108556099444145910243884249123272753835196094595735828560593886549706202821360729966212919836071016187794411200454682068981836300681098224156531639842209297777220250045105015</span>, <span class="number">173287806459060855056978404566038662455264340360403434058797921467696881992461886820974507593896975956673635068182667307551397235117090256800473173760922218094509836540044524144073307976531893785817268555430923542035419459537615158405264410714554348532449071393153250670293668267831809663639016079737049993532</span>, <span class="number">110367489208453437299284319505293878991095171003329152569229822459210424547301175160255795581820578959629690051139383553782954098870270063851900045993344035739536369769062409357695761165417611332640635883761689554713983143014247113573513500943553569138485111921531165356036728439854269183574182361770067877382</span>]</span><br><span class="line">val = <span class="number">4587129147169223135177082248247577247287230696838250360893151376678832017794662311496645432391215540389204568010806710075971796695505304027066300219073996196566364920871649278153101805335618485690679631760671100407668295798900270041393585528052410778685339781812407359874425601526059126165668484671578858665132491434454904136915398866378458071913624317667264519275308368507047649155997427360113558401018558028857800979164191767840984644802095146231460160633834780847547723464319670338864485176202467124809407088132810097750468091447438249060863489382657696069166135186865875148261692352214220481602521790532932330766</span></span><br><span class="line"></span><br><span class="line">seq[<span class="number">4</span>] -= val</span><br><span class="line">iseq0 = <span class="built_in">pow</span>(seq[<span class="number">0</span>], -<span class="number">1</span>, N)</span><br><span class="line">seq = [x * iseq0 % N <span class="keyword">for</span> x <span class="keyword">in</span> seq]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Problem to equation (default)</span></span><br><span class="line">P.&lt;x&gt; = PolynomialRing(ZmodN) <span class="comment">#, implementation=&#x27;NTL&#x27;)</span></span><br><span class="line">pol = seq[<span class="number">0</span>] * x^<span class="number">4</span> + seq[<span class="number">1</span>] * x^<span class="number">3</span> + seq[<span class="number">2</span>] * x^<span class="number">2</span> + seq[<span class="number">3</span>] * x^<span class="number">1</span> + seq[<span class="number">4</span>]</span><br><span class="line">dd = pol.degree()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tweak those</span></span><br><span class="line">beta = <span class="number">1023</span> / <span class="number">2048</span>                               </span><br><span class="line">epsilon = beta * beta / <span class="number">4</span> - <span class="number">81</span> / <span class="number">2048</span>   <span class="comment"># &lt;= beta / 7</span></span><br><span class="line">mm = ceil(beta**<span class="number">2</span> / (dd * epsilon))     <span class="comment"># optimized value</span></span><br><span class="line">tt = floor(dd * mm * ((<span class="number">1</span>/beta) - <span class="number">1</span>))    <span class="comment"># optimized value</span></span><br><span class="line">XX = ceil(N**((beta**<span class="number">2</span>/dd) - epsilon))  <span class="comment"># optimized value</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Coppersmith</span></span><br><span class="line">start_time = time.time()</span><br><span class="line">roots = coppersmith_howgrave_univariate(pol, N, beta, mm, tt, XX)</span><br><span class="line"></span><br><span class="line"><span class="comment"># output</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n# Solutions&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;we found:&quot;</span>, <span class="built_in">str</span>(roots))</span><br><span class="line"><span class="built_in">print</span>((<span class="string">&quot;in: %s seconds &quot;</span> % (time.time() - start_time)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="comment"># root = 821507932957358336850308</span></span><br><span class="line">root = <span class="built_in">int</span>(roots[<span class="number">0</span>])</span><br><span class="line">poly = seq[<span class="number">0</span>] * (root ** <span class="number">4</span>) + seq[<span class="number">1</span>] * (root ** <span class="number">3</span>) + seq[<span class="number">2</span>] * (root ** <span class="number">2</span>) + seq[<span class="number">3</span>] * root + seq[<span class="number">4</span>]</span><br><span class="line">p = math.gcd(poly, N)</span><br><span class="line">q = N // p</span><br><span class="line"><span class="keyword">assert</span> p * q == N</span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">pt = <span class="built_in">pow</span>(c, d, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(pt)[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure>

            </div>

            <!-- Post information -->
            
    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 post-tags">
        
            <i class="fas fa-tag" style="vertical-align: middle;font-size: .8rem;"></i>
            tags:&nbsp;
            
            
        
            <a href="/ctf-note/tags/writeup/">#writeup</a>
        
    </div>

            
    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1">
        <ul class="pagination d-block text-center">
            
                <li class="previous page-item d-inline"><a href="/ctf-note/2021/07/28/Imaginary-CTF-2021/" class="page-link float-left">&larr;  Newer Posts</a></li>
            
            
                <li class="next page-item d-inline"><a href="/ctf-note/2021/07/20/Smart-s-Attack/" class="page-link float-right">Older Posts  &rarr;</a></li>
            
        </ul>
    </div>


            
                <!-- Comments -->
                

                

            

        </div>
    </div>
</article> 


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    <style>
        #toc-content .toc-link::before {
            background-color: transparent;
            max-height: 25px;
        }

        #toc-content .toc-link.is-active-link::before {
            background-color: #404040;
        }
    </style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <div class="ui-toc dropup scrollspy-body pull-right" style="right: 3%;">
        <button type="button" class="toc-btn btn btn-light" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-display="static">
            <i class="fas fa-list"></i>
        </button>
        <div class="dropdown-menu dropdown-menu-right p-2"  aria-labelledby="tocLabel">
            <div class="toc-widget">
                <div id="toc-content" class="text-truncate">
                </div>
            </div>
            <div class="toc-menu pt-3 pl-4">
                <a class="expand-toggle d-block py-1" href="#"><span class="expand-text">Expand all</span><span class="close-text" style="display: none;">Collapse all</span></a>
                <a class="back-to-top d-block py-1" href="#">Back to top</a>
                <a class="go-to-bottom d-block py-1" href="#">Go to bottom</a>
            </div>
        </div>
    </div>
    <script>
        tocbot.init({
            // Where to render the table of contents.
            tocSelector: '#toc-content',
            // Where to grab the headings to build the table of contents.
            contentSelector: 'article',
            // Which headings to grab inside of the contentSelector element.
            headingSelector: 'h1, h2, h3',
            // For headings inside relative or absolute positioned containers within content.
            hasInnerContainers: true,
        });
    </script>


    <script src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script>
        MathJax.Hub.Config({
            tex2jax:{inlineMath:[['$', '$']]}
        })
    </script>

    


    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer id="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 text-center">
                <ul class="list-inline">
                    

                    

                    

                    

                    

                    
                </ul>
                <p class="copyright footer-author">
                    &copy; 2021-2023 
                    <a rel="external" class="copyright-link" href="" target="_blank">Utaha</a><br/>
                    Powered by <a rel="external" class="copyright-link" href="https://hexo.io/" target="_blank">Hexo</a>  
                    <span class="copyright-split">&nbsp;|&nbsp;&nbsp;</span>
                    Theme <a rel="external" class="copyright-link" href="https://github.com/luswdev/hexo-theme-clean.git" target="_blank">Clean</a>
                    
                    
                        <span id="busuanzi_container_site_uv">
                            <span class="copyright-split">&nbsp;|&nbsp;</span>
                            <i class="fas fa-user-friends"></i>&nbsp;&nbsp;<span id="busuanzi_value_site_uv"></span>&nbsp;
                        </span>
                    
                </p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    <!-- jQuery -->
<script src="//cdn.jsdelivr.net/npm/jquery@2.1.4/dist/jquery.min.js"></script>

<!-- For drop down -->
<script src="//cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>

<!-- Bootstrap -->
<script src="//cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"></script>
<!-- Gallery -->
<script src="//cdn.jsdelivr.net/npm/lightgallery@1.6.11/dist/js/lightgallery-all.min.js"></script>
<!-- Busuanzi -->

    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<!-- Search script -->

<script src="/ctf-note/js/search.js"></script>

<script type="text/javascript">
    $(function () {
        searchFunc( '/ctf-note/search.xml' , 'searchInput', 'searchResult');
    });
</script>



<script src="/ctf-note/js/main.js"></script>



    <!-- Search Modal -->
    <!-- Modal -->
<div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content overflow-auto">
            <div class="modal-header">
                <input type="text" class="form-control" placeholder="Searching Keywords..." id="searchInput">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="searchResult">
                    <div class="search-empty text-center text-muted p-5">
                        <i class="far fa-meh"></i>
                    </div>
                </div>
            </div> 
        </div>
    </div>
</div>


</body>
</html>